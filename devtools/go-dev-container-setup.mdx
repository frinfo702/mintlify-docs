---
title: "Go + Dev Containers"
description: "VS Code Dev Containers で Go プロジェクト用の再現性のある開発環境を構築する"
---

VS Code Dev Containers を使うと、Go のバージョンやツールチェーンをプロジェクト専用の Docker イメージに閉じ込め、チーム全員が同じ環境からスタートできます。

## 前提条件

- Docker Desktop (または互換エンジン)
- VS Code + <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers">Dev Containers</a> 拡張
- Go モジュール化されたリポジトリ（`go.mod`）

## 最小構成

プロジェクトルートで以下を作成します。

```bash
mkdir -p .devcontainer
cat <<'JSON' > .devcontainer/devcontainer.json
{
  "name": "Uyu Go",
  "image": "mcr.microsoft.com/devcontainers/go:1.21",
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {}
  },
  "postCreateCommand": "go mod tidy",
  "customizations": {
    "vscode": {
      "extensions": [
        "golang.go",
        "eamodio.gitlens"
      ]
    }
  }
}
JSON
```

<Info>VS Code が `postCreateCommand` を実行するため、Go モジュールの依存関係が初回起動時に同期されます。</Info>

## 起動手順

<Steps>
  <Step title="コンテナに切り替える">
    VS Code のコマンドパレットで **Dev Containers: Reopen in Container** を選択。初回はベースイメージのダウンロードに数分かかります。
  </Step>
  <Step title="動作確認">
    コンテナ内ターミナルで `go version` を実行し、指定したバージョン（例: 1.21）が表示されることを確認します。
    <Check>VS Code のステータスバーに "Dev Container" バッジが表示されれば、リモート環境が有効です。</Check>
  </Step>
  <Step title="ホットリロードを準備する">
    <Tabs>
      <Tab title="Air">
        `cosmtrek/air` を `go install github.com/cosmtrek/air@latest` で追加し、`air.toml` を `.devcontainer` に配置します。
      </Tab>
      <Tab title="Taskfile">
        `go-task/task` を使う場合は `brew install go-task/tap/go-task` を追加し、`Taskfile.yml` に `task dev` を定義します。
      </Tab>
    </Tabs>
  </Step>
</Steps>

## Docker Compose を使った複合環境

API とデータベースを同時に立ち上げたい場合は `docker-compose.yml` を組み合わせます。

```json
{
  "name": "Go + Postgres",
  "dockerComposeFile": [
    "docker-compose.yml"
  ],
  "service": "api",
  "workspaceFolder": "/workspace",
  "forwardPorts": [8080, 5432]
}
```

## よくあるトラブル

<AccordionGroup>
  <Accordion title="Docker デーモンに接続できない">
    ホスト側で Docker Desktop が起動していること、また rootless モードの場合は `docker context` を `default` に戻すことを確認してください。
  </Accordion>
  <Accordion title="VS Code 拡張が同期されない">
    `devcontainer.json` の `customizations.vscode.extensions` を確認し、再ビルド (`Dev Containers: Rebuild Container`) を実行します。
  </Accordion>
  <Accordion title="go.sum の差分が毎回出る">
    `postCreateCommand` を `go mod download` に変更し、手動で `go mod tidy` を実行することで自動更新を抑制できます。
  </Accordion>
</AccordionGroup>
